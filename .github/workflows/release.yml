name: Release datafile

on:
  push:
    branches: [master]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest

    env:
      DATAFILE_ID: rudy
      DATAFILE_LANG: pl

      # generate
      DATAFILE_QUALITY: 1

      # upload
      DATAFILE_POSITION: 1

    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - name: Checkout datafile repo
        uses: actions/checkout@v2
        with:
          repository: bartekpacia/datafile-rudy
          path: "datafiles"

      - name: Checkout database-tools
        uses: actions/checkout@v2
        with:
          repository: bartekpacia/database-tools

      - name: Create service account file
        run: echo "$FIREBASE_SERVICE_ACCOUNT" > ./key.json

      - name: Install database-tools
        run: make

      - name: Generate datafile
        run: touristdb generate -id $DATAFILE_ID --lang $DATAFILE_LANG -q $DATAFILE_QUALITY -v

      - name: Compress datafile
        run: touristdb compress -id $DATAFILE_ID -v

      - name: Upload datafile
        run: echo "Uploading datafile" # ./touristdb upload -id rudy -pos $DATAFILE_POSITION
